<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html
xmlns='http://www.w3.org/1999/xhtml'><head><link
rel='icon' href='data:image/gif;base64,R0lGODlhIAAgAPAAAAAAAAAAACH5BAEAAAEALAAAAAAgACAAAAJFjI+py+0Po5y02quA3rz7zXziGI4mV55nqpIY8r1wJxsxpSX3hNpe9dvxVJjVyyUTJn81H60ZUB6ZTWoVBD3kstyut1sAADs=' /><title>Voronoi Diagrams | nullwise</title><meta
http-equiv='Content-Type' content='text/html;charset=utf-8' /><meta
name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no' /><link
rel='stylesheet' href='../../style.css?v=sun_01_may' type='text/css' /><script type='text/javascript' src='../../scripts/images.js'></script><script type='text/javascript'>/*<![CDATA[*/function ol() { var i = document.getElementsByTagName('iframe'); if(i.length > 0 && i[0].hasAttribute('delay_src')) i[0].src = i[0].getAttribute('delay_src'); }/*]]>*/</script></head><body
onload='ol();'><div
class='header'><div
class='menu'><div
class='row page_width'><span
class='entry'><a
href='../../index.html'>Home</a> </span><span
class='entry'><a
href='../../contact.html'>Contact</a> </span></div><div
class='hr'></div></div></div><div
class='content page_width'><div
class='extrabox'><h2>Download</h2><a
class='download' href='main.c'><span></span>main.c</a></div><h1>Voronoi diagrams</h1> A while ago I wanted to do create some background graphics for this website, so I tried to generate some nice looking <a
class='external' href='https://en.wikipedia.org/wiki/Voronoi_diagram'>Voronoi diagrams<span></span></a>. For a one off tool like this I think it's okay to take some shortcuts that might otherwise not be reasonable.
So I used the <a
class='external' href='https://en.wikipedia.org/wiki/Netpbm_format'>Netpbm<span></span></a> file format to output images, it is easy to use, quick to get going and requires a relatively small amount of code. My image viewer happens to support this format, but otherwise I could have used a commandline tool like 'convert' as an intermediate step before viewing the output.<h2>Getting set up</h2> Let's start by creating a small program that does nothing more than create a 512x512 canvas, fills it with random colors and then writes it to disk. To compile and run the program all you should need to do is create a file named 'main.c', fill it with the code below and then run the following commands:<pre><tt style='float: left;'><span class="normal">$ gcc </span><span class="symbol">-</span><span class="usertype">o</span><span class="normal"> voronoi </span><span class="symbol">-</span><span class="normal">Wall </span><span class="symbol">-</span><span class="normal">Werror </span><span class="symbol">-</span><span class="normal">O3 </span><span class="symbol">-</span><span class="usertype">lm</span><span class="normal"> main</span><span class="symbol">.</span><span class="normal">c</span>
<span class="normal">$ </span><span class="symbol">./</span><span class="normal">voronoi</span>
<span class="normal">$ </span><span class="usertype">your_preffered_image_viewer</span><span class="normal"> output</span><span class="symbol">.</span><span class="normal">ppm</span></tt></pre><pre><tt style='float: left;'><span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stdio.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stdlib.h&gt;</span>

<span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">struct</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">  </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> r</span><span class="symbol">,</span><span class="normal"> g</span><span class="symbol">,</span><span class="normal"> b</span><span class="symbol">;</span>
<span class="cbracket">}</span><span class="normal"> RGBu8</span><span class="symbol">;</span>

<span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">struct</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> width</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> height</span><span class="symbol">;</span>
<span class="normal">  </span><span class="usertype">RGBu8</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">pixels</span><span class="symbol">;</span>
<span class="cbracket">}</span><span class="normal"> Image</span><span class="symbol">;</span>

<span class="comment">// Write an image to a file using the binary PPM file format</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">image_to_ppm6</span><span class="symbol">(</span><span class="usertype">Image</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">img</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">filename</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">  </span><span class="usertype">FILE</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">output </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fopen</span><span class="symbol">(</span><span class="normal">filename</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"wb"</span><span class="symbol">);</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">output</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">fprintf</span><span class="symbol">(</span><span class="normal">output</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"P6</span><span class="specialchar">\n</span><span class="string">%d %d</span><span class="specialchar">\n</span><span class="string">255</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span><span class="normal"> img</span><span class="symbol">-&gt;</span><span class="normal">width</span><span class="symbol">,</span><span class="normal"> img</span><span class="symbol">-&gt;</span><span class="normal">height</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">fwrite</span><span class="symbol">(</span><span class="normal">img</span><span class="symbol">-&gt;</span><span class="normal">pixels</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">img</span><span class="symbol">-&gt;</span><span class="normal">pixels</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">])</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> img</span><span class="symbol">-&gt;</span><span class="normal">width </span><span class="symbol">*</span><span class="normal"> img</span><span class="symbol">-&gt;</span><span class="normal">height</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> output</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">fclose</span><span class="symbol">(</span><span class="normal">output</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="function">main</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> argc</span><span class="symbol">,</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">argv</span><span class="symbol">[])</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">  </span><span class="comment">// Create a 512x512 canvas</span>
<span class="normal">  </span><span class="usertype">Image</span><span class="normal"> img</span><span class="symbol">;</span>
<span class="normal">  img</span><span class="symbol">.</span><span class="normal">width </span><span class="symbol">=</span><span class="normal"> </span><span class="number">512</span><span class="symbol">;</span>
<span class="normal">  img</span><span class="symbol">.</span><span class="normal">height </span><span class="symbol">=</span><span class="normal"> </span><span class="number">512</span><span class="symbol">;</span>
<span class="normal">  img</span><span class="symbol">.</span><span class="normal">pixels </span><span class="symbol">=</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">img</span><span class="symbol">.</span><span class="normal">pixels</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">])</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> img</span><span class="symbol">.</span><span class="normal">width </span><span class="symbol">*</span><span class="normal"> img</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">);</span>

<span class="normal">  </span><span class="comment">// Iterate over every pixel on the canvas</span>
<span class="normal">  </span><span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> y </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> y </span><span class="symbol">&lt;</span><span class="normal"> img</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">;</span><span class="normal"> y</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> x </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> x </span><span class="symbol">&lt;</span><span class="normal"> img</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">;</span><span class="normal"> x</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> r</span><span class="symbol">,</span><span class="normal"> g</span><span class="symbol">,</span><span class="normal"> b</span><span class="symbol">;</span>
<span class="normal">      r </span><span class="symbol">=</span><span class="normal"> </span><span class="function">rand</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">%</span><span class="normal"> </span><span class="number">256</span><span class="symbol">;</span>
<span class="normal">      g </span><span class="symbol">=</span><span class="normal"> </span><span class="function">rand</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">%</span><span class="normal"> </span><span class="number">256</span><span class="symbol">;</span>
<span class="normal">      b </span><span class="symbol">=</span><span class="normal"> </span><span class="function">rand</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">%</span><span class="normal"> </span><span class="number">256</span><span class="symbol">;</span>
<span class="normal">      img</span><span class="symbol">.</span><span class="normal">pixels</span><span class="symbol">[</span><span class="normal">x</span><span class="symbol">+</span><span class="normal">y</span><span class="symbol">*</span><span class="normal">img</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">RGBu8</span><span class="symbol">)</span><span class="cbracket">{</span><span class="normal">r</span><span class="symbol">,</span><span class="normal"> g</span><span class="symbol">,</span><span class="normal"> b</span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="comment">// Write the canvas to a file</span>
<span class="normal">  </span><span class="function">image_to_ppm6</span><span class="symbol">(&amp;</span><span class="normal">img</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"output.ppm"</span><span class="symbol">);</span>
<span class="normal">  </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span></tt><div onclick='imageViewer.showImage("random_image.png", "", "")' class='incode_img' style='width: 128px;' ><a onclick='return false;' href='random_image.png'><img style='border: 0px' src='thumbs/random_image.png' alt='' /></a></div></pre><h2>Randomly distributed points</h2> To draw a voronoi diagram we'll need some points to define the voronoi cells. We create an array of 128 points and place them randomly within the bounds of the canvas. As a quick visualisation of these points we use an inefficient (but easy to write) algorithm. The algorithm iterates over all pixels in the canvas and for each pixel it iterates over all of the randomly generated points. If a pixel's coordinates within the canvas are the same as one of the randomly chosen points it will be colored white, otherwise it will be black.<pre><tt style='float: left;'><span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;math.h&gt;</span>

<span class="symbol">...</span>

<span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">struct</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">  </span><span class="type">float</span><span class="normal"> x</span><span class="symbol">,</span><span class="normal"> y</span><span class="symbol">;</span>
<span class="cbracket">}</span><span class="normal"> Vec2</span><span class="symbol">;</span>

<span class="symbol">...</span>

<span class="usertype">Vec2</span><span class="normal"> points</span><span class="symbol">[</span><span class="number">128</span><span class="symbol">];</span>
<span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]);</span><span class="normal"> i</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">  points</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">x </span><span class="symbol">=</span><span class="normal"> </span><span class="function">rand</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="symbol">(</span><span class="type">float</span><span class="symbol">)</span><span class="normal">RAND_MAX </span><span class="symbol">*</span><span class="normal"> img</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">;</span>
<span class="normal">  points</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">y </span><span class="symbol">=</span><span class="normal"> </span><span class="function">rand</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="symbol">(</span><span class="type">float</span><span class="symbol">)</span><span class="normal">RAND_MAX </span><span class="symbol">*</span><span class="normal"> img</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="symbol">...</span>

<span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> y </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> y </span><span class="symbol">&lt;</span><span class="normal"> img</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">;</span><span class="normal"> y</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">  </span><span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> x </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> x </span><span class="symbol">&lt;</span><span class="normal"> img</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">;</span><span class="normal"> x</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> r</span><span class="symbol">,</span><span class="normal"> g</span><span class="symbol">,</span><span class="normal"> b</span><span class="symbol">;</span>
<span class="normal">    r </span><span class="symbol">=</span><span class="normal"> g </span><span class="symbol">=</span><span class="normal"> b </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]);</span><span class="normal"> i</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">x </span><span class="symbol">==</span><span class="normal"> </span><span class="function">roundf</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">x</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> y </span><span class="symbol">==</span><span class="normal"> </span><span class="function">roundf</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">y</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        r </span><span class="symbol">=</span><span class="normal"> g </span><span class="symbol">=</span><span class="normal"> b </span><span class="symbol">=</span><span class="normal"> </span><span class="number">255</span><span class="symbol">;</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    img</span><span class="symbol">.</span><span class="normal">pixels</span><span class="symbol">[</span><span class="normal">x</span><span class="symbol">+</span><span class="normal">y</span><span class="symbol">*</span><span class="normal">img</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">RGBu8</span><span class="symbol">)</span><span class="cbracket">{</span><span class="normal">r</span><span class="symbol">,</span><span class="normal"> g</span><span class="symbol">,</span><span class="normal"> b</span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="cbracket">}</span></tt><div onclick='imageViewer.showImage("randomly_distributed_points.png", "", "")' class='incode_img' style='width: 128px;' ><a onclick='return false;' href='randomly_distributed_points.png'><img style='border: 0px' src='thumbs/randomly_distributed_points.png' alt='' /></a></div></pre><h2>Basic Voronoi Diagram</h2> Now that we have points to define the voronoi regions we can create a diagram. For every pixel in the canvas we iterate over all points and calculate the distance between them while keeping track of the one that has the smallest distance. When that is done we use the index of the point to calculate the pixel's color.<pre><tt style='float: left;'><span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;float.h&gt;</span>

<span class="symbol">...</span>

<span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> y </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> y </span><span class="symbol">&lt;</span><span class="normal"> img</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">;</span><span class="normal"> y</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">  </span><span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> x </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> x </span><span class="symbol">&lt;</span><span class="normal"> img</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">;</span><span class="normal"> x</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> r</span><span class="symbol">,</span><span class="normal"> g</span><span class="symbol">,</span><span class="normal"> b</span><span class="symbol">;</span>

<span class="normal">    </span><span class="type">int</span><span class="normal"> closest_point </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">float</span><span class="normal"> smallest_distance </span><span class="symbol">=</span><span class="normal"> FLT_MAX</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]);</span><span class="normal"> i</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>

<span class="normal">      </span><span class="type">float</span><span class="normal"> dx </span><span class="symbol">=</span><span class="normal"> points</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">x </span><span class="symbol">-</span><span class="normal"> x</span><span class="symbol">;</span>
<span class="normal">      </span><span class="type">float</span><span class="normal"> dy </span><span class="symbol">=</span><span class="normal"> points</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">y </span><span class="symbol">-</span><span class="normal"> y</span><span class="symbol">;</span>
<span class="normal">      </span><span class="type">float</span><span class="normal"> distance </span><span class="symbol">=</span><span class="normal"> </span><span class="function">sqrtf</span><span class="symbol">(</span><span class="normal">dx</span><span class="symbol">*</span><span class="normal">dx</span><span class="symbol">+</span><span class="normal">dy</span><span class="symbol">*</span><span class="normal">dy</span><span class="symbol">);</span>

<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">distance </span><span class="symbol">&lt;</span><span class="normal"> smallest_distance</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        smallest_distance </span><span class="symbol">=</span><span class="normal"> distance</span><span class="symbol">;</span>
<span class="normal">        closest_point </span><span class="symbol">=</span><span class="normal"> i</span><span class="symbol">;</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">float</span><span class="normal"> color </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">closest_point </span><span class="symbol">/</span><span class="normal"> </span><span class="symbol">(</span><span class="type">float</span><span class="symbol">)(</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">)/</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">])));</span>
<span class="normal">    r </span><span class="symbol">=</span><span class="normal"> g </span><span class="symbol">=</span><span class="normal"> b </span><span class="symbol">=</span><span class="normal"> color </span><span class="symbol">*</span><span class="normal"> </span><span class="number">255</span><span class="symbol">;</span>
<span class="normal">    img</span><span class="symbol">.</span><span class="normal">pixels</span><span class="symbol">[</span><span class="normal">x</span><span class="symbol">+</span><span class="normal">y</span><span class="symbol">*</span><span class="normal">img</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">RGBu8</span><span class="symbol">)</span><span class="cbracket">{</span><span class="normal">r</span><span class="symbol">,</span><span class="normal"> g</span><span class="symbol">,</span><span class="normal"> b</span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="cbracket">}</span></tt><div onclick='imageViewer.showImage("basic_voronoi_diagram.png", "", "")' class='incode_img' style='width: 128px;' ><a onclick='return false;' href='basic_voronoi_diagram.png'><img style='border: 0px' src='thumbs/basic_voronoi_diagram.png' alt='' /></a></div></pre>And that is all there is to creating a simple voronoi diagram from scratch using C. Now this is obviously not a remotely good looking diagram so I'll have to explore some other ways of rendering it.<h2>Coloring pixels by their distance to the closest point</h2> Instead of using the index of the closest point to color a pixel we could use the distance itself. One reason using the index isn't very nice is because it changes abruptly at the edges of the voronoi cells causing aliasing. The distance on the other hand changes continuously (without any sudden large jumps in value) across the entire image.<pre><tt style='float: left;'><span class="type">float</span><span class="normal"> color </span><span class="symbol">=</span><span class="normal"> smallest_distance </span><span class="symbol">/</span><span class="normal"> </span><span class="number">80</span><span class="symbol">;</span>
<span class="keyword">if</span><span class="symbol">(</span><span class="normal">color </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> color </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">.</span><span class="normal">0f</span><span class="symbol">;</span>
<span class="keyword">if</span><span class="symbol">(</span><span class="normal">color </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> color </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">.</span><span class="normal">0f</span><span class="symbol">;</span></tt><div onclick='imageViewer.showImage("color_by_dist_to_point.png", "", "")' class='incode_img' style='width: 128px;' ><a onclick='return false;' href='color_by_dist_to_point.png'><img style='border: 0px' src='thumbs/color_by_dist_to_point.png' alt='' /></a></div></pre><pre><tt style='float: left;'><span class="type">float</span><span class="normal"> color </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">.</span><span class="normal">0f </span><span class="symbol">-</span><span class="normal"> smallest_distance </span><span class="symbol">/</span><span class="normal"> </span><span class="number">60</span><span class="symbol">;</span>
<span class="keyword">if</span><span class="symbol">(</span><span class="normal">color </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> color </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">.</span><span class="normal">0f</span><span class="symbol">;</span>
<span class="keyword">if</span><span class="symbol">(</span><span class="normal">color </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> color </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">.</span><span class="normal">0f</span><span class="symbol">;</span></tt><div onclick='imageViewer.showImage("color_by_dist_to_point_inverted.png", "", "")' class='incode_img' style='width: 128px;' ><a onclick='return false;' href='color_by_dist_to_point_inverted.png'><img style='border: 0px' src='thumbs/color_by_dist_to_point_inverted.png' alt='' /></a></div></pre>While these look interesting in their own right they do not really look like voronoi diagrams anymore. So maybe we can try something where the edges between the cells are more defined but transition in a continuous way. That's what we'll do next.<h2>Coloring pixels by their distance to the closest edge</h2> If we want to make sure the edges of the voronoi cells are easily discernable it would be nice to know what the distance of a pixel is to the closest edge of the voronoi cell it is in. This is a slightly more involved calculation than the distance calculation from before. First we need to know what defines the edges of a voronoi cell. The lines on which the edges of a voronoi cell lie are each defined by exactly two points <b>p1</b>,<b>p2</b> (the point defining the voronoi cells) in the diagram. In fact every point on these lines is equidistant to those two points <b>p1</b> and <b>p2</b>. This is the dotted line in the diagram below, also displayed in the diagram is <b>m</b> the midpoint inbetween <b>p1</b> and <b>p2</b> which lies on the dotted line.<center><div
onclick='imageViewer.showImage("p1p2_and_m.png", "", "")' class='cscs' style='width: 128px;' ><a
onclick='return false;' href='p1p2_and_m.png'><img
style='border: 0px' src='thumbs/p1p2_and_m.png' alt='' /></a></div></center> We don't really care about this dotted line but we simply want to know what the distance of a third point <b>p3</b> (the pixel) is to that dotted line. That distance <b>r</b> is shown in the diagram below.<center><div
onclick='imageViewer.showImage("p1p2p3_and_rm.png", "", "")' class='cscs' style='width: 128px;' ><a
onclick='return false;' href='p1p2p3_and_rm.png'><img
style='border: 0px' src='thumbs/p1p2p3_and_rm.png' alt='' /></a></div></center> To calculate <b>r</b>, we can use the <a
class='external' href='https://en.wikipedia.org/wiki/Scalar_projection'>Scalar projection<span></span></a> of the vector <b>p3-m</b> onto the vector <b>p1-m</b>.<center><div
onclick='imageViewer.showImage("p3_projected.png", "", "")' class='cscs' style='width: 128px;' ><a
onclick='return false;' href='p3_projected.png'><img
style='border: 0px' src='thumbs/p3_projected.png' alt='' /></a></div></center><div
style='clear: left;'><pre><tt style='float: left;'><span class="type">float</span><span class="normal"> closest_edge_distance </span><span class="symbol">=</span><span class="normal"> FLT_MAX</span><span class="symbol">;</span>
<span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]);</span><span class="normal"> i</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>

<span class="normal">  </span><span class="type">float</span><span class="normal"> midpoint_x </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">[</span><span class="normal">closest_point</span><span class="symbol">].</span><span class="normal">x </span><span class="symbol">+</span><span class="normal"> points</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">x</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">.</span><span class="normal">0f</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">float</span><span class="normal"> midpoint_y </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">points</span><span class="symbol">[</span><span class="normal">closest_point</span><span class="symbol">].</span><span class="normal">y </span><span class="symbol">+</span><span class="normal"> points</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">y</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">.</span><span class="normal">0f</span><span class="symbol">;</span>

<span class="normal">  </span><span class="type">float</span><span class="normal"> m_p3_x </span><span class="symbol">=</span><span class="normal"> x </span><span class="symbol">-</span><span class="normal"> midpoint_x</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">float</span><span class="normal"> m_p3_y </span><span class="symbol">=</span><span class="normal"> y </span><span class="symbol">-</span><span class="normal"> midpoint_y</span><span class="symbol">;</span>

<span class="normal">  </span><span class="type">float</span><span class="normal"> m_p1_x </span><span class="symbol">=</span><span class="normal"> points</span><span class="symbol">[</span><span class="normal">closest_point</span><span class="symbol">].</span><span class="normal">x </span><span class="symbol">-</span><span class="normal"> midpoint_x</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">float</span><span class="normal"> m_p1_y </span><span class="symbol">=</span><span class="normal"> points</span><span class="symbol">[</span><span class="normal">closest_point</span><span class="symbol">].</span><span class="normal">y </span><span class="symbol">-</span><span class="normal"> midpoint_y</span><span class="symbol">;</span>

<span class="normal">  </span><span class="type">float</span><span class="normal"> len_m_p1 </span><span class="symbol">=</span><span class="normal"> </span><span class="function">sqrtf</span><span class="symbol">(</span><span class="normal">m_p1_x</span><span class="symbol">*</span><span class="normal">m_p1_x </span><span class="symbol">+</span><span class="normal"> m_p1_y</span><span class="symbol">*</span><span class="normal">m_p1_y</span><span class="symbol">);</span>
<span class="normal">  </span><span class="type">float</span><span class="normal"> unit_dx </span><span class="symbol">=</span><span class="normal"> m_p1_x </span><span class="symbol">/</span><span class="normal"> len_m_p1</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">float</span><span class="normal"> unit_dy </span><span class="symbol">=</span><span class="normal"> m_p1_y </span><span class="symbol">/</span><span class="normal"> len_m_p1</span><span class="symbol">;</span>

<span class="normal">  </span><span class="type">float</span><span class="normal"> proj </span><span class="symbol">=</span><span class="normal"> m_p3_x </span><span class="symbol">*</span><span class="normal"> unit_dx </span><span class="symbol">+</span><span class="normal"> m_p3_y </span><span class="symbol">*</span><span class="normal"> unit_dy</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">proj </span><span class="symbol">&lt;</span><span class="normal"> closest_edge_distance</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    closest_edge_distance </span><span class="symbol">=</span><span class="normal"> proj</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="type">float</span><span class="normal"> color </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0.1</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">0.9</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">closest_edge_distance </span><span class="symbol">/</span><span class="normal"> </span><span class="number">30</span><span class="symbol">.</span><span class="normal">0f</span><span class="symbol">);</span>
<span class="keyword">if</span><span class="symbol">(</span><span class="normal">color </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> color </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">.</span><span class="normal">0f</span><span class="symbol">;</span>
<span class="keyword">if</span><span class="symbol">(</span><span class="normal">color </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> color </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">.</span><span class="normal">0f</span><span class="symbol">;</span></tt><div onclick='imageViewer.showImage("color_by_dist_to_edge.png", "", "")' class='incode_img' style='width: 128px;' ><a onclick='return false;' href='color_by_dist_to_edge.png'><img style='border: 0px' src='thumbs/color_by_dist_to_edge.png' alt='' /></a></div></pre>Now we have rendered the voronoi cells with clearly defined edges while also avoiding the aliasing that occured in our first attempt. There are all sorts of small variations possible, some of which I've displayed below.</div><h2>Gallery</h2><div
onclick='imageViewer.showImage("01.png", "", "")' class='cscs' style='width: 128px;' ><a
onclick='return false;' href='01.png'><img
style='border: 0px' src='thumbs/01.png' alt='' /></a></div><div
onclick='imageViewer.showImage("03.png", "", "")' class='cscs' style='width: 128px;' ><a
onclick='return false;' href='03.png'><img
style='border: 0px' src='thumbs/03.png' alt='' /></a></div><div
onclick='imageViewer.showImage("04.png", "", "")' class='cscs' style='width: 128px;' ><a
onclick='return false;' href='04.png'><img
style='border: 0px' src='thumbs/04.png' alt='' /></a></div><div
onclick='imageViewer.showImage("06.png", "", "")' class='cscs' style='width: 128px;' ><a
onclick='return false;' href='06.png'><img
style='border: 0px' src='thumbs/06.png' alt='' /></a></div><div
onclick='imageViewer.showImage("02.png", "", "")' class='cscs' style='width: 128px;' ><a
onclick='return false;' href='02.png'><img
style='border: 0px' src='thumbs/02.png' alt='' /></a></div><div
onclick='imageViewer.showImage("08.png", "", "")' class='cscs' style='width: 128px;' ><a
onclick='return false;' href='08.png'><img
style='border: 0px' src='thumbs/08.png' alt='' /></a></div><div
onclick='imageViewer.showImage("09.png", "", "")' class='cscs' style='width: 128px;' ><a
onclick='return false;' href='09.png'><img
style='border: 0px' src='thumbs/09.png' alt='' /></a></div><div
onclick='imageViewer.showImage("10.png", "", "")' class='cscs' style='width: 128px;' ><a
onclick='return false;' href='10.png'><img
style='border: 0px' src='thumbs/10.png' alt='' /></a></div><h2>References</h2>[1] <a
class='external' href='https://en.wikipedia.org/wiki/Voronoi_diagram'>Voronoi diagrams<span></span></a><br>[2] <a
class='external' href='https://en.wikipedia.org/wiki/Netpbm_format'>Netpbm<span></span></a><br>[3] <a
class='external' href='https://en.wikipedia.org/wiki/Scalar_projection'>Scalar projection<span></span></a><br><div
style='clear: both'></div></div></body></html>